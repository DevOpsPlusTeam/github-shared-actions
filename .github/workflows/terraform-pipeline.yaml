name: "Terraform shared github actions"

on:
  workflow_call:
    inputs:
      secrets:
        AWS_ACCESS_KEY_ID:
          required: true
        AWS_SECRET_ACCESS_KEY:
          required: true

jobs:
  terraform-checks:
    name: "Terraform Checks"
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v2

      - name: Terraform Format
        id: fmt
        run: terraform fmt -check

      - name: Terraform Init
        id: init
        run: terraform init

      - name: Terraform Validate
        id: validate
        run: terraform validate -no-color

      - name: Terraform Plan
        id: plan
        run: terraform plan -no-color

  # terraform-plan:
  #     name: "Terraform Plan"
  #     runs-on: ubuntu-latest
  #     needs: [terraform-checks]
  #     steps:
  #     - name: Terraform plan
  #       id: plan
  #       if: startsWith(github.ref, 'refs/heads/master') || startsWith(github.ref, 'refs/heads/main') || startsWith(github.ref, 'refs/tags/release-')
  #       run: terraform plan -no-color -out=terraform.tfplan

  # terraform-apply:
  #     name: "Terraform Apply"
  #     runs-on: ubuntu-latest
  #     environment: "prod"
  #     needs: [terraform-plan]
  #     steps:
  #     - name: Terraform apply
  #       id: apply
  #       if: startsWith(github.ref, 'refs/tags/release-')
  #       run: terraform apply "terraform.tfplan"

